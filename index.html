<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>시너지 턴 카드 배틀 v1.5</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <main class="app">
    <header class="top-bar">
      <div>
        <h1>시너지 턴 카드 배틀 v1.5</h1>
        <p class="subtitle">캔버스 HUD + 랜덤 덱 정비 오버레이를 적용한 서버리스 러닝 모드</p>
      </div>
      <div class="controls">
        <button id="start-btn">새 런 시작</button>
        <button id="resume-btn">이어하기</button>
        <button id="reset-save-btn">저장 초기화</button>
        <button id="open-codex-btn" type="button">도감 페이지</button>
        <button id="open-hall-btn" type="button">명예의 전당</button>
      </div>
    </header>

    <section class="status-grid">
      <article class="panel battle-stage">
        <h2>배틀 스테이지</h2>
        <div class="canvas-wrap">
          <canvas id="battle-canvas" width="960" height="330" aria-label="배틀 전장"></canvas>
          <div class="arena-overlay">
            <div class="fighter enemy" id="enemy-sprite">
              <div class="fighter-name">적</div>
              <div class="hp-track"><div id="enemy-hp-fill" class="hp-fill"></div></div>
            </div>
            <div class="vs-mark">VS</div>
            <div class="fighter player" id="player-sprite">
              <div class="fighter-name">플레이어</div>
              <div class="hp-track"><div id="player-hp-fill" class="hp-fill"></div></div>
            </div>
          </div>
          <section id="canvas-deckbuild-overlay" class="canvas-deckbuild-overlay hidden">
            <h3>라운드 정비 (랜덤 후보)</h3>
            <p class="small">보상 카드 1장 선택/건너뛰기 후, 랜덤 제거 후보에서 0~1장 제거하세요.</p>
            <div class="controls">
              <button id="skip-reward-btn">보상 건너뛰기</button>
              <button id="finish-deck-build-btn" disabled>다음 전투</button>
            </div>
            <div class="canvas-build-grid">
              <article>
                <h4>랜덤 보상 카드 선택</h4>
                <div id="reward-cards" class="hand compact"></div>
              </article>
              <article>
                <h4>랜덤 카드 제거 후보</h4>
                <div id="remove-deck-cards" class="hand compact"></div>
              </article>
            </div>
          </section>
        </div>
      </article>

      <article class="panel">
        <h2>플레이어</h2>
        <p>HP: <span id="player-hp">72</span> / <span id="player-max-hp">72</span></p>
        <p>방어: <span id="player-block">0</span></p>
        <p>에너지: <span id="player-energy">0</span> / 3</p>
      </article>

      <article class="panel">
        <h2>적 (<span id="enemy-name">-</span>)</h2>
        <p>HP: <span id="enemy-hp">0</span> / <span id="enemy-max-hp">0</span></p>
        <p>방어: <span id="enemy-block">0</span></p>
        <p>에너지: <span id="enemy-energy">0</span> / 3</p>
        <p>의도: <span id="enemy-intent">-</span></p>
        <p>위협 단계: <span id="enemy-threat">1</span></p>
        <p>적 행동 규칙: <span id="enemy-actions">에너지 소진형</span></p>
      </article>

      <article class="panel">
        <h2>런 정보</h2>
        <p>지역: <span id="region-name">-</span></p>
        <p>라운드: <span id="round-info">0 / 0</span></p>
        <p>상태: <span id="battle-state">ready</span></p>
        <p>턴 소유자: <span id="turn-owner">-</span></p>
        <p>점수: <span id="score">0</span></p>
      </article>
    </section>

    <section class="panel battle-controls">
      <h2>전투 조작</h2>
      <p id="turn-guide" class="small">카드를 사용한 뒤 턴을 종료해 주세요.</p>
      <div class="controls controls-bottom">
        <button id="end-turn-btn" disabled>턴 종료</button>
      </div>
    </section>

    <section class="panel">
      <h2>시너지 / 목표</h2>
      <div id="synergy-info" class="badge-wrap"></div>
      <div id="synergy-effects" class="deck-list"></div>
      <p id="goal-text" class="small">목표: 10라운드를 돌파하고 최종 보스를 처치하세요.</p>
    </section>

    <section class="panel">
      <h2>손패</h2>
      <div id="hand" class="hand"></div>
      <p class="small">드로우: <span id="player-draw">0</span> | 버림: <span id="player-discard">0</span> | 덱: <span id="deck-size">0</span></p>
    </section>

    <section id="discover-panel" class="panel hidden">
      <h2>아카이브 스캔 결과 (임시 획득)</h2>
      <p class="small">카드 도감에서 1장을 선택해 즉시 손패에 추가합니다.</p>
      <div id="discover-cards" class="hand"></div>
    </section>

    <section id="route-panel" class="panel hidden">
      <h2>분기 경로 선택</h2>
      <p class="small">다음 전투 지역과 적을 선택하세요. 경로별로 시작 효과가 다릅니다.</p>
      <div id="route-choices" class="deck-list"></div>
    </section>

    <section class="panel">
      <h2>내가 사용한 카드</h2>
      <p class="small">최근에 사용한 카드 12장을 순서대로 보여줍니다.</p>
      <div id="played-cards" class="history-list"></div>
    </section>

    <section class="panel">
      <h2>전투 로그</h2>
      <div id="log" class="log"></div>
    </section>
  </main>

  <script>
    const isFileProtocol = window.location.protocol === 'file:';

    if (isFileProtocol) {
      const app = document.querySelector('.app');
      app.innerHTML = `
        <section class="panel">
          <h2>실행 방식 안내</h2>
          <p>보안 정책(CORS) 때문에 <code>index.html</code>을 파일로 직접 열면 게임 스크립트를 불러올 수 없습니다.</p>
          <p>아래처럼 로컬 서버로 실행해 주세요.</p>
          <pre>python3 -m http.server 8000
http://localhost:8000</pre>
        </section>
      `;
      console.error('[실행 오류] file:// 경로에서는 ES 모듈 로딩이 차단됩니다. 로컬 서버로 실행해 주세요.');
    } else {
      const script = document.createElement('script');
      script.type = 'module';
      script.src = './game.js';
      document.body.appendChild(script);
    }
  </script>
</body>
</html>
