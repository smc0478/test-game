# GAME_SPEC.md

## Spec Version
- **Version:** v1.5.1
- **Project:** Synergy Turn Card Battle
- **Owner Role:** Producer (Game Designer)
- **Language:** Korean
- **Last Updated:** 2026-02-13

## 1) Design Goal
v1.5.1은 기존 전투 흐름을 유지하면서 **적 개체별 전장 초상화 + 오버레이 가시성 보강**을 도입해 전장 정보 인지를 강화한다.

## 2) Scope

### Scope In (v1.5.1)
- 상태 머신:
  - `ready`
  - `planning`
  - `playerTurn`
  - `enemyTurn`
  - `resolution`
  - `deckBuild`
  - `routeSelect`
  - `gameOver`
  - `runComplete`
- 라운드 수: 10 라운드 유지.
- 지역/적/분기 시스템 유지.
- 적 난이도 스케일링:
  - 라운드 진행에 따라 위협 단계 1~4 상승.
  - 위협 단계에 따라 적 에너지 +0~+3.
  - 6라운드부터 적 드로우 +1.
- 적 멀티 행동 규칙:
  - 턴당 행동 슬롯 상한 없이, 에너지가 허용하는 범위 내에서 연속 카드 사용.
  - 사용 가능한 카드가 남아 있고 에너지가 충분하면 같은 턴에 여러 장을 이어서 사용.
  - 안전장치로 단일 턴 행동 반복은 12회에서 종료.
- 밸런스 규칙:
  - 턴당 안전 반복 상한(12회)으로 예외적 무한 행동 루프를 방지.
  - 의도 선택 규칙(공격/스킬 교차, 직전 카드 반복 회피) 유지.
  - Gear 카드의 드로우+에너지 동시 제공 금지(무한 콤보 방지).
  - Gear 핵심 카드의 드로우/재발동/전환 효율을 하향 조정.
- 전투 UI 개선:
  - 적 14종 각각에 대해 전장 오버레이 전용 초상 이미지가 존재해야 한다.
  - 플레이어/적 전장 카드(오버레이)에는 초상 + 이름 + HP 바가 동시에 노출되어야 한다.
  - 모바일 폭(860px 이하)에서도 오버레이 구성요소가 겹치지 않도록 최소 높이를 보장한다.
- 덱 빌드 개선:
  - 보상 카드 후보 3장은 매 라운드 무작위로 생성한다.
  - 카드 제거는 덱 전체 선택이 아니라 무작위 제거 후보(최대 3장)에서만 0~1장 선택 가능하다.
  - 제거/보상 선택 창을 전장 캔버스 오버레이로 제공해 스크롤 없이 진행 가능해야 한다.
- 시너지/저장/명예의 전당 기능 유지.

### Scope Out (v1.3)
- 상점/맵 탐험 UI/멀티플레이/클라우드 저장.
- 영구 메타 성장.
- 카드 업그레이드 단계.
- 실시간 물리 엔진 기반 애니메이션.
## 3) Core Battle Rules
- 플레이어 HP: 84
- 에너지: 턴당 3
- 드로우: 턴 시작 5
- 손패 최대: 8
- 방어도: 턴 시작 시 0
- 취약(`vulnerable`)은 턴 시작 시 1 감소
- 동시 KO: 패배
- 런 길이: 10라운드

## 4) Card System
카드 필수 필드:
- `id`, `name`, `family`, `type`, `energyCost`, `baseValue`, `sigil`, `image`, `effect[]`, `description`

문양(`sigil`): Flame / Leaf / Gear / Void

기어 카드 밸런스 제한(v1.3.1):
- 드로우 카드에는 에너지 충전(`gainEnergy`)을 함께 부여하지 않는다.
- `rewind`/`discover`/`convertBlockToDamage`는 Gear 카드에서 코스트 혹은 수치를 낮춰 폭주를 억제한다.

## 5) Synergy & Burst Rules
- 동일 문양 2회 이상 사용 시 시너지 활성.
- Flame: 공격 추가 +6
- Leaf: 방어 추가 +6
- Gear: 드로우 +1
- Void: 공격 추가 +4 + 공격 시 흡혈 2
- 같은 문양 3회 사용 시 문양 버스트 1회 발동.

## 6) Enemy Intent Rule
- `planning` 상태에서 적이 다음 사용할 카드 의도를 확정.
- 의도 교차(공격↔스킬) 우선 + 직전 카드 반복 회피 우선.
- 적 턴 동안 매 행동마다 다시 의도를 계산해 다음 카드를 선택한다.


## 6-1) Enemy Scaling Rule
- 난이도 단계 = `1 + floor(round / 3)` (최대 4).
- 단계만큼 적 턴 시작 에너지 보너스를 얻는다.
- 6라운드 이후 적은 턴 시작 시 카드 1장을 추가로 드로우한다.
- 적은 턴 시작 에너지를 가능한 한 모두 소모하도록 행동을 반복한다.

## 7) Deck Build + Route Rule
- 라운드 승리 후 `deckBuild` 진입.
- 순서:
  1. 무작위 보상 카드 3장 중 1장 선택 또는 건너뛰기
  2. 무작위 제거 후보(최대 3장) 중 0~1장 제거
  3. `routeSelect`에서 다음 경로 선택
  4. 다음 라운드 진입
- 제거는 덱이 5장 이하일 때 금지.

## 8) Score Rules
- 플레이어 공격 카드 사용: +10
- 플레이어 스킬 카드 사용: +8
- 문양 버스트 발동: +15
- 라운드 승리: +100
- 고체력(HP 40+) 승리: +30
- 덱 정리(카드 제거) 성공: +6
- 런 클리어: +200
- 패배: 최종 점수 0

## 9) Required Files
- `index.html`
- `style.css`
- `game.js`
- `hall.html`
- `hall.js`
- `src/storage.js`

## Change Log

### v1.5.1 (2026-02-13)
- 적 14종 각각에 대응하는 SVG 기반 전장 초상화를 추가해 전투 오버레이에서 적 정체성을 즉시 확인할 수 있도록 했다.
- 플레이어/적 오버레이 카드에 초상 이미지를 배치해 HP 바만 보이던 영역의 정보 부족 문제를 개선했다.
- 모바일 레이아웃에서 전장 오버레이 요소가 가려지던 문제를 방지하도록 최소 높이/정렬 규칙을 보강했다.

### v1.5.0 (2026-02-13)
- 캔버스 HUD에 라운드/적 의도/손패 사용 가능 카드 수/진행 힌트를 표시해 전투 핵심 정보를 전장 내에서 즉시 확인하도록 변경했다.
- 덱 빌드 단계의 보상 카드 선택을 명시적으로 무작위 3장 후보 체계로 고정했다.
- 카드 제거를 덱 전체 목록 선택에서 무작위 제거 후보 선택 방식으로 변경했다.
- 보상/카드 제거 UI를 캔버스 오버레이로 이동해 스크롤 없이 한 화면 진행이 가능하도록 했다.

### v1.4.1 (2026-02-13)
- 적 턴 행동 규칙을 "행동 슬롯 기반"에서 "에너지 소진 기반"으로 변경했다.
- 적이 턴 내에 여러 카드를 연속 사용해 남은 에너지를 최대한 활용하도록 명시했다.
- 무한 루프 방지를 위해 적 턴 행동 안전 상한(12회)을 추가했다.

### v1.4.0 (2026-02-13)
- 전장을 DOM 패널에서 Canvas 렌더링 방식으로 확장해 캐릭터/배경/턴 정보를 실시간 드로잉하도록 변경했다.
- 턴 종료 버튼을 하단 전투 조작 섹션으로 이동해 카드 선택 동선과 조작 동선을 일치시켰다.
- 턴 소유자 변경 시 공격 펄스 애니메이션을 추가해 실제 교전 감각을 강화했다.

### v1.3.1 (2026-02-17)
- 기어 카드 전반(C004/C007/C008/C015/C020/C022/C025/C029/C031/C034)의 수치를 하향 조정했다.
- 드로우 계열 기어 카드에서 에너지 동시 회복 조합을 제거해 무한 콤보 루프를 차단했다.
- 확장 카드의 `기어 순환`/`시간 메아리`도 동일 규칙으로 너프했다.

### v1.3.0 (2026-02-16)
- 적 라운드 스케일링(위협 단계/에너지/드로우)을 추가해 후반 난이도를 상승시켰다.
- 적이 턴당 최대 3장의 카드를 연속 사용하는 멀티 행동 규칙을 추가했다.
- 포켓몬 배틀 스타일의 VS 스테이지 패널과 HP 바/공격 애니메이션 UI를 추가했다.


### v1.2.0 (2026-02-15)
- 시너지 효과 안내 패널(문양별 발동 수치 + 버스트 규칙)을 전투 화면에 추가.
- localStorage 자동 저장/이어하기/저장 초기화를 추가.
- 명예의 전당 페이지(`hall.html`)를 추가해 최근 30회 런의 승패/점수/최종 적/주요 카드 기록을 제공.


### v1.1.0 (2026-02-14)
- 상태 머신에 `routeSelect`를 추가하고 분기 경로 선택 단계를 구현.
- 런 길이를 10라운드로 확장.
- 지역을 6개로, 적을 14종으로 확장.
- 경로별 시작 효과(모디파이어) 4종을 추가.

### v1.0.0 (2026-02-14)
- 카드 풀을 100장(C001~C100)으로 확장.
- 적 도감(Bestiary)과 추천 덱 운영 가이드를 `codex.html`에 추가.
