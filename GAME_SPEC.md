# GAME_SPEC.md

## Spec Version
- **Version:** v2.4.0
- **Project:** Synergy Turn Card Battle
- **Owner Role:** Producer (Game Designer)
- **Language:** Korean
- **Last Updated:** 2026-02-13

## 1) Design Goal
v2.4.0은 기존 21장 카드 풀에 **리프 방어 컨셉 카드 5장**을 추가해 Leaf 문양의 수비-반격 빌드 경로를 세분화한다.

핵심 목표:
- 플레이어가 한 화면에서 전장/스탯/행동 버튼/손패를 즉시 인지한다.
- 시너지 폭주를 줄이고, 라운드 후반 난이도를 완만하게 조정한다.

## 2) Scope

### Scope In (v2.4.0)
- 상태 머신 유지:
  - `ready`
  - `planning`
  - `playerTurn`
  - `enemyTurn`
  - `resolution`
  - `deckBuild`
  - `routeSelect`
  - `gameOver`
  - `runComplete`
- 전투 UI 재구성:
  - 상단: 배틀 스테이지 캔버스 + VS 오버레이 + 전장 초상 카드.
- 전투 엔진 분리 구조:
  - `src/core/battleCore.js`에서 상태 머신/전투 로직/AI를 관리.
  - `src/phaserBattle.js`에서 BootScene/BattleScene 렌더링을 담당.
  - DOM 카드는 유지하고 전장 렌더는 Phaser Scene으로 대체.
- 배틀 스테이지에서 플레이어/적 위치를 교체(플레이어 좌측, 적 우측).
- Phaser 인터랙션 기반 hover 툴팁 표시(플레이어/적 정보 패널).
- 오버레이 입력 정책 명확화:
  - 배틀 오버레이 패널은 `pointer-events: none`
  - 클릭 가능한 보상/카드 제거 패널만 `pointer-events: auto`
  - 중단: 플레이어/적/런 정보 스탯 패널 3열 구성.
  - 하단: 전투 조작 + 시너지 안내 + 손패 카드 영역.
- 카드 풀을 26장으로 구성한다(기본 16장 + 화염 컨셉 5장 + 리프 컨셉 5장).
- 신규 리프 방어 컨셉 5종을 추가한다.
  1. 기본 방어 카드와 다른 코스트/수치의 고효율 방어 카드
  2. 같은 이름 카드 반복 사용 시 누적 추가 방어 카드
  3. 현재 방어도만큼 공격하는 반격 카드
  4. 방어/가시를 함께 얻는 신규 방어 카드
  5. 코스트 3, 방어도를 2턴 유지시키는 유지 카드
- 각 문양은 동일 스펙의 역할 카드 4종을 가진다: 공격 1장, 방어 1장, 드로우 1장, 회복 1장.
- 시작 덱은 8장(문양별 공격/방어 카드 2장씩)으로 구성한다.
- 카드 이미지 필드는 SVG 데이터 URL 생성 방식을 유지한다.
- 런 길이는 50라운드를 유지한다.
- 적 아키타입을 34종으로 확장하고, 카드 컨셉 8종 각각에 대응하는 전용 적 1종을 추가.
- 지역(경로 노드) 10개, 경로 테이블 12패턴을 순환 적용.
- 1라운드(`round=1`) 동안 적 턴 에너지를 최대 1로 제한.
- 덱 정비(랜덤 보상 3장 + 랜덤 제거 후보 최대 3장) 유지.

### Scope Out
- 상점/맵 탐험 UI/멀티플레이/클라우드 저장.
- 영구 메타 성장.
- 카드 업그레이드 단계.
- 실시간 물리 엔진 기반 애니메이션.
- Phaser 외 엔진(Pixi/Unity) 전환.

## 3) Core Battle Rules
- 플레이어 HP: **78**
- 에너지: 턴당 3
- 드로우: 턴 시작 5
- 손패 최대: 8
- 방어도: 턴 시작 시 0
- 취약(`vulnerable`)은 턴 시작 시 1 감소
- 동시 KO: 패배
- 런 길이: 50라운드

## 4) Card System
카드 필수 필드:
- `id`, `name`, `family`, `type`, `energyCost`, `baseValue`, `sigil`, `image`, `effect[]`, `description`

문양(`sigil`): Flame / Leaf / Gear / Void
- 카드 풀: 총 26장
- 문양별 카드 스펙(공통):
  - 공격 카드: 코스트 1, 피해 8
  - 방어 카드: 코스트 1, 방어 8
  - 드로우 카드: 코스트 1, 드로우 2
  - 회복 카드: 코스트 1, 회복 5
- 카드 ID 범위: C001~C026
- 신규 화염 컨셉 카드:
  - C017: `화염 가속` (공격 6 + 추가 피해 3)
  - C018: `화염 공명` (같은 이름 카드 반복 시 반복당 추가 피해 4)
  - C019: `화염 예열` (다음 공격 1회 추가 피해 +6)
  - C020: `화염 낙인` (적에게 피해 11)
  - C021: `화염 점화` (피해 7 + 에너지 1)

- 신규 리프 방어 컨셉 카드:
  - C022: `잎새 중갑` (코스트 2, 방어 14)
  - C023: `잎새 연쇄방진` (방어 6 + 같은 이름 반복당 방어 4 추가)
  - C024: `잎새 역습` (현재 방어도만큼 공격)
  - C025: `잎새 가시덩굴` (방어 5 + 가시 3)
  - C026: `잎새 성역` (코스트 3, 방어 18 + 방어 2턴 유지)

제한:
- Gear 카드의 드로우+에너지 동시 폭주 금지 원칙 유지.
- 카드 효과는 순수 로직 연산으로 처리.

## 5) Synergy & Burst Rules (v1.6.0)
- 동일 문양 2회 이상 사용 시 시너지 활성.
- Flame: 공격 추가 +5
- Leaf: 방어 추가 +7
- Gear: 드로우 +1
- Void: 공격 추가 +3 + 공격 시 흡혈 1
- 같은 문양 4회 사용 시 문양 버스트 1회 발동.
- 버스트 발동 점수: +15

추가 템포 규칙:
- 문양 2종 이상 활성화 시 아드레날린 1회: 에너지 +1, 점수 +8
- 콤보 체인 3 이상 시 프리즘 버스트 1회: 방어 6 + 추가 피해 8, 점수 +12

## 6) Enemy Intent + Scaling Rule
- `planning` 상태에서 적 의도를 확정.
- 의도 교차(공격↔스킬) 및 직전 카드 반복 회피 우선.
- 난이도 단계 = `1 + floor(round / 7)` (최대 8).
- 적 에너지 보너스:
  - 단계 1: +0
  - 단계 2~3: +1
  - 단계 4~6: +2
  - 단계 7~8: +3
- 단, 1라운드에는 위 보너스와 무관하게 적 턴 시작 에너지를 최대 1로 제한.
- 단계 4(대략 22라운드)부터 적 드로우 +1.
- 적은 가능한 범위에서 에너지를 소진하도록 연속 행동(최대 12회 안전 제한).

## 7) Deck Build + Route Rule
- 라운드 승리 후 `deckBuild` 진입.
- 순서:
  1. 무작위 보상 카드 3장 중 1장 선택 또는 건너뛰기
  2. 무작위 제거 후보(최대 3장) 중 0~1장 제거
  3. `routeSelect`에서 다음 경로 선택
  4. 다음 라운드 진입
- 제거는 덱 5장 이하 시 금지.

## 8) Score Rules
- 플레이어 공격 카드 사용: +9
- 플레이어 스킬 카드 사용: +7
- 문양 버스트 발동: +15
- 라운드 승리: +110
- 고체력(HP 36+) 승리: +25
- 덱 정리(카드 제거) 성공: +6
- 런 클리어: +200
- 패배: 최종 점수 0

## 9) Required Files
- `index.html`
- `style.css`
- `game.js`
- `hall.html`
- `hall.js`
- `src/storage.js`

## Change Log

### v2.4.0 (2026-02-13)
- 리프 문양에 방어 컨셉 카드 5장(C022~C026)을 추가해 수비-반격 선택지를 확장했다.
- 신규 효과 타입(`nameRepeatBlockBonus`, `attackFromBlock`, `retainBlockTurns`)을 도입했다.
- 카드 아트는 기존 SVG 데이터 URL 생성 방식을 그대로 사용해 신규 카드 이미지 자산을 자동 생성했다.

### v2.2.0 (2026-02-13)
- 카드 풀을 0장에서 16장으로 확장했다(문양별 공격/방어/드로우/회복 1장씩).
- 시작 덱을 8장으로 구성해 전투 시작 즉시 시너지 테스트가 가능하도록 조정했다.
- 카드 아트는 기존 SVG 데이터 URL 생성 방식을 유지해 모든 신규 카드에 이미지를 부여했다.

### v2.3.0 (2026-02-13)
- 화염 문양에 컨셉 카드 5장(C017~C021)을 추가해 공격 계열 선택지를 확장했다.
- 신규 효과 타입(같은 이름 반복 추가 피해, 다음 공격 추가 피해 예약)을 도입했다.
- 카드 아트는 기존 SVG 데이터 URL 생성 방식을 그대로 사용해 신규 카드 이미지 자산을 자동 생성했다.

### v2.1.0 (2026-02-13)
- 모든 카드 데이터를 제거해 `CARD_LIBRARY`를 빈 객체로 전환했다.
- 시작 덱을 빈 배열로 조정해 카드 컨셉을 순차 지정하는 워크플로우를 준비했다.
- 카드가 없는 상태에서도 적 덱 매핑에서 무효 카드가 제거되도록 규칙을 명시했다.

### v2.0.0 (2026-02-13)
- 카드 풀을 168장에서 100장으로 재편하고, 20개 카드 컨셉마다 정확히 5장씩 배치했다.
- 확장 카드 생성 방식을 반복 수치 증가형에서 컨셉-역할 고정형으로 변경했다.
- 수치만 바꾸는 단순 카드 수를 3장으로 제한해 카드 간 역할 차이를 강화했다.

### v1.9.0 (2026-02-13)
- 카드 컨셉 8종(난수 도박/리프 방진/가시 반격/기어 순환/오버히트 절단/공허 갈증/의도 추적/시간 메아리)마다 전용 적 1종을 추가했다.
- 카드 풀을 168장(C001~C168)으로 확장해 신규 컨셉 적이 참조하는 카드 구성을 완성했다.
- 지역별 적 편성에 컨셉 전용 적을 분산 배치해 라운드별 체감 패턴 다양성을 높였다.

### v1.8.0 (2026-02-13)
- 런 길이를 50라운드로 확장하고 장기 런 스케일링(단계 1~8)을 적용했다.
- 적 아키타입을 26종으로 확장하고 지역을 10개로 늘려 경로 선택 다양성을 강화했다.
- 카드 풀을 160장(C001~C160)으로 확장해 보상/덱 빌드 선택 폭을 크게 확대했다.
- 경로 테이블 12패턴을 라운드 순환으로 적용해 50라운드 동안 선택지가 고정되지 않도록 조정했다.

### v1.7.1 (2026-02-13)
- 초반 난이도 급등을 줄이기 위해 1라운드 적 턴 에너지를 최대 1로 제한했다.

### v1.7.0 (2026-02-13)
- 배틀 스테이지 렌더링을 Canvas 수동 루프에서 Phaser Scene(BootScene/BattleScene) 구조로 전환했다.
- 전투 코어를 `src/core/battleCore.js`로 분리하고, UI 렌더와 로직 의존을 분리했다.
- 플레이어/적 위치를 교체하고 Phaser 상호작용 hover 패널로 전장 정보 접근성을 높였다.
- DOM 하이브리드 구조를 유지하면서 오버레이 입력 정책(pointer-events)을 정리했다.

### v1.6.0 (2026-02-13)
- 전투 화면을 실전형 레이아웃(상단 전장 / 중단 스탯 / 하단 손패)으로 재정렬했다.
- 플레이어 기본 HP를 78로 조정하고 점수 공식을 재조정했다.
- 문양 시너지 수치(Flame/Leaf/Void)와 버스트 트리거를 4회 기준으로 리밸런싱했다.
- 아드레날린/프리즘 보너스 수치를 하향해 폭주 콤보 빈도를 낮췄다.
- 적 스케일링의 최종 에너지 보너스를 +2로 캡해 후반 난이도 급등을 완화했다.

### v1.5.1 (2026-02-13)
- 적 14종 각각에 대응하는 SVG 기반 전장 초상화를 추가해 전투 오버레이에서 적 정체성을 즉시 확인할 수 있도록 했다.
- 플레이어/적 오버레이 카드에 초상 이미지를 배치해 HP 바만 보이던 영역의 정보 부족 문제를 개선했다.
- 모바일 레이아웃에서 전장 오버레이 요소가 가려지던 문제를 방지하도록 최소 높이/정렬 규칙을 보강했다.
